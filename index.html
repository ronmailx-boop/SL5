<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×¨×©×™××ª ×§× ×™×•×ª ×—×›××”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #f4f7fa; padding-bottom: 160px; overflow-x: hidden; }
        
        .bottom-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: #7367f0; z-index: 1000; padding: 10px 10px 25px 10px; border-radius: 35px 35px 0 0; 
        }

        .item-card {
            background: white; border-radius: 25px; padding: 15px; margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03); display: flex; flex-direction: column;
        }

        .modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(2px); 
        }

        /* ×¢×™×¦×•×‘ ×›×¤×ª×•×¨ ×”×× ×¢×•×œ ×›×©×”×•× ×¤×¢×™×œ/×›×ª×•× */
        .lock-btn-edit { background-color: #ff9f43 !important; } /* ×›×ª×•× ×¢×– */
        .lock-btn-locked { background-color: #48a9f8 !important; } /* ×›×—×•×œ */
    </style>
</head>
<body>

    <div id="priceModal" class="modal-overlay">
        <div class="bg-white w-80 p-6 rounded-3xl text-center shadow-2xl">
            <h2 class="text-lg font-bold mb-4 text-indigo-600">×¢×“×›×•×Ÿ ××—×™×¨</h2>
            <input type="number" id="newPriceInput" inputmode="decimal" class="w-full p-3 border rounded-xl mb-4 text-center text-xl font-bold outline-none">
            <div class="flex gap-3">
                <button onclick="confirmPriceUpdate()" class="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl">×¢×“×›×Ÿ</button>
                <button onclick="closePriceModal()" class="flex-1 py-3 bg-gray-100 font-bold rounded-xl text-gray-600">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal-overlay">
        <div class="bg-white w-80 p-6 rounded-3xl text-center shadow-2xl">
            <h2 class="text-lg font-bold mb-4">×œ××—×•×§ ××ª ×›×œ ×”×¨×©×™××”?</h2>
            <div class="flex gap-3">
                <button onclick="confirmClearAll()" class="flex-1 py-3 bg-red-500 text-white font-bold rounded-xl">××—×§ ×”×›×œ</button>
                <button onclick="closeDeleteModal()" class="flex-1 py-3 bg-gray-100 font-bold rounded-xl text-gray-600">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto p-4">
        <div class="bg-white rounded-2xl p-4 mb-4 flex justify-between items-center shadow-sm">
            <div>
                <h1 class="text-xl font-bold text-slate-800">×”×¨×©×™××” ×©×œ×™</h1>
                <span id="statusTag" class="text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full text-[10px] font-bold mt-1 inline-block">××¦×‘ ×¢×¨×™×›×”</span>
            </div>
            <button onclick="shareToWhatsApp()" class="p-2 text-indigo-500 bg-indigo-50 rounded-full">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.319 1.592 5.548 0 10.058-4.51 10.06-10.059.002-2.689-1.047-5.215-2.951-7.119-1.906-1.906-4.432-2.956-7.123-2.957-5.549 0-10.059 4.511-10.061 10.06-.001 2.105.56 4.111 1.621 5.895l-.997 3.638 3.732-.98zm11.367-7.404c-.3-.15-1.771-.874-2.046-.974-.275-.1-.475-.15-.675.15-.2.3-.775.974-.95 1.174-.175.2-.35.225-.65.075-.3-.15-1.265-.467-2.41-1.487-.892-.795-1.493-1.777-1.668-2.077-.175-.3-.018-.462.13-.611.134-.134.3-.35.45-.525.15-.175.2-.3.3-.5s.05-.375-.025-.525c-.075-.15-.675-1.625-.925-2.225-.244-.589-.493-.51-.675-.52l-.575-.01c-.2 0-.525.075-.8.375s-1.05 1.025-1.05 2.5 1.075 2.9 1.225 3.1c.15.2 2.115 3.23 5.125 4.53.716.31 1.274.495 1.71.635.72.23 1.375.197 1.893.12.577-.087 1.771-.725 2.021-1.425.25-.7.25-1.3.175-1.425-.075-.125-.275-.2-.575-.35z"/></svg>
            </button>
        </div>

        <div id="inputForm" class="hidden bg-white p-5 rounded-3xl shadow-lg mb-4 border-2 border-indigo-400">
            <input type="text" id="itemName" placeholder="×©× ×”××•×¦×¨" class="w-full p-3 border rounded-xl mb-3 outline-none">
            <input type="number" id="itemPrice" inputmode="decimal" placeholder="××—×™×¨" class="w-full p-3 border rounded-xl mb-3 outline-none">
            <div class="flex gap-2">
                <button onclick="addItem()" class="flex-1 bg-green-500 text-white py-3 rounded-xl font-bold">×”×•×¡×£</button>
                <button onclick="toggleInputForm()" class="flex-1 bg-gray-100 py-3 rounded-xl font-bold">×¡×’×•×¨</button>
            </div>
        </div>

        <div id="itemsList"></div>
    </div>

    <div class="bottom-bar text-white">
        <div class="flex justify-around mb-4 px-4 text-center">
            <div><div class="text-[10px] opacity-70">×¡×”"×›</div><div class="text-xl font-bold">â‚ª<span id="totalSum">0.00</span></div></div>
            <div class="w-px bg-white/20 h-8 self-center"></div>
            <div><div class="text-[10px] opacity-70">×©×•×œ×</div><div class="text-xl font-bold">â‚ª<span id="paidSum">0.00</span></div></div>
        </div>
        
        <div class="flex items-center justify-around">
            <button id="lockBtn" onclick="toggleLock()" class="w-12 h-12 lock-btn-edit rounded-full flex items-center justify-center shadow-lg active:scale-90 transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path id="lockPath" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"></path></svg>
            </button>

            <button onclick="toggleInputForm()" class="w-16 h-16 bg-[#28c76f] rounded-full flex items-center justify-center shadow-2xl border-4 border-white/20 active:scale-95 transition">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="4" d="M12 4v16m8-8H4"></path></svg>
            </button>

            <button onclick="openDeleteModal()" class="w-12 h-12 bg-[#ea5455] rounded-full flex items-center justify-center shadow-lg active:scale-90 transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    </div>

    <script>
        let shoppingList = JSON.parse(localStorage.getItem('LIST_V6')) || [];
        let isLocked = false;
        let currentEditIndex = null;
        let sortableInstance = null;

        function render() {
            const container = document.getElementById('itemsList');
            container.innerHTML = '';
            shoppingList.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = "item-card";
                div.dataset.id = item.id;
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleCheck(${index})" class="w-6 h-6 rounded accent-indigo-600">
                            <span class="text-xl font-bold text-slate-800 ${item.checked ? 'line-through text-slate-300' : ''}">${item.name}</span>
                        </div>
                        <button onclick="removeItem(${index})" class="text-red-400">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2 bg-gray-50 border border-gray-100 rounded-xl px-2 py-1">
                            <button onclick="updateQty(${index}, 1)" class="text-green-500 font-bold text-xl px-2">+</button>
                            <span class="font-bold text-lg text-slate-700 min-w-[20px] text-center">${item.qty}</span>
                            <button onclick="updateQty(${index}, -1)" class="text-red-500 font-bold text-xl px-2">-</button>
                        </div>
                        <div class="flex items-center gap-4">
                            <span onclick="openPriceModal(${index})" class="text-lg font-bold text-indigo-600 cursor-pointer">â‚ª${(item.unitPrice * item.qty).toFixed(2)}</span>
                            <div class="drag-handle text-slate-300 text-xl cursor-grab ${isLocked ? 'hidden' : ''}">â ¿</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
            calculate();
            initSort();
        }

        function initSort() {
            const el = document.getElementById('itemsList');
            if (sortableInstance) sortableInstance.destroy();
            if (!isLocked) {
                sortableInstance = Sortable.create(el, {
                    handle: '.drag-handle', animation: 150,
                    onEnd: (evt) => {
                        const movedItem = shoppingList.splice(evt.oldIndex, 1)[0];
                        shoppingList.splice(evt.newIndex, 0, movedItem);
                        save();
                    }
                });
            }
        }

        function toggleInputForm() { 
            const form = document.getElementById('inputForm');
            form.classList.toggle('hidden');
            if(!form.classList.contains('hidden')) document.getElementById('itemName').focus();
        }

        function addItem() {
            const name = document.getElementById('itemName').value;
            const price = parseFloat(document.getElementById('itemPrice').value) || 0;
            if(!name) return;
            shoppingList.push({ id: Date.now().toString(), name, unitPrice: price, qty: 1, checked: false });
            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            toggleInputForm();
            save();
        }

        function openPriceModal(index) { currentEditIndex = index; document.getElementById('newPriceInput').value = shoppingList[index].unitPrice; document.getElementById('priceModal').style.display='flex'; }
        function closePriceModal() { document.getElementById('priceModal').style.display='none'; }
        function confirmPriceUpdate() { 
            shoppingList[currentEditIndex].unitPrice = parseFloat(document.getElementById('newPriceInput').value) || 0; 
            closePriceModal(); save(); 
        }

        function openDeleteModal() { if(shoppingList.length > 0) document.getElementById('deleteModal').style.display='flex'; }
        function closeDeleteModal() { document.getElementById('deleteModal').style.display='none'; }
        function confirmClearAll() { shoppingList = []; closeDeleteModal(); save(); }

        function calculate() {
            const total = shoppingList.reduce((acc, i) => acc + (i.unitPrice * i.qty), 0);
            const paid = shoppingList.filter(i => i.checked).reduce((acc, i) => acc + (i.unitPrice * i.qty), 0);
            document.getElementById('totalSum').innerText = total.toFixed(2);
            document.getElementById('paidSum').innerText = paid.toFixed(2);
        }

        function toggleCheck(index) { shoppingList[index].checked = !shoppingList[index].checked; save(); }
        function updateQty(index, val) { if(shoppingList[index].qty + val >= 1) { shoppingList[index].qty += val; save(); } }
        function removeItem(index) { shoppingList.splice(index, 1); save(); }
        function save() { localStorage.setItem('LIST_V6', JSON.stringify(shoppingList)); render(); }
        
        function toggleLock() {
            isLocked = !isLocked;
            const btn = document.getElementById('lockBtn');
            const path = document.getElementById('lockPath');
            const tag = document.getElementById('statusTag');
            
            if (isLocked) {
                btn.className = "w-12 h-12 lock-btn-locked rounded-full flex items-center justify-center shadow-lg transition";
                tag.innerText = "× ×¢×•×œ";
                tag.className = "text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full text-[10px] font-bold mt-1 inline-block";
                path.setAttribute('d', "M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z");
            } else {
                btn.className = "w-12 h-12 lock-btn-edit rounded-full flex items-center justify-center shadow-lg transition";
                tag.innerText = "××¦×‘ ×¢×¨×™×›×”";
                tag.className = "text-orange-600 bg-orange-50 px-2 py-0.5 rounded-full text-[10px] font-bold mt-1 inline-block";
                path.setAttribute('d', "M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z");
            }
            render();
        }

        function shareToWhatsApp() {
            if (shoppingList.length === 0) return;
            let text = "ğŸ›’ *×¨×©×™××ª ×”×§× ×™×•×ª ×©×œ×™:*\n\n";
            shoppingList.forEach(i => text += `${i.checked ? 'âœ…' : 'â¬œ'} *${i.name}* (x${i.qty}) - â‚ª${(i.unitPrice * i.qty).toFixed(2)}\n`);
            text += `\nğŸ’° *×¡×”"×›: â‚ª${document.getElementById('totalSum').innerText}*`;
            window.open("https://wa.me/?text=" + encodeURIComponent(text), '_blank');
        }

        render();
    </script>
</body>
</html>

